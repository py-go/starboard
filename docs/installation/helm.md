# Helm

[Helm], which is de facto standard package manager for Kubernetes, allows installing applications from parameterized
YAML manifests called Helm [charts].

To address shortcomings of [static YAML manifests](kubectl.md) we provide the Helm chart to deploy the Starboard
Operator. The Helm chart supports all [Install Modes](../configuration.md#install-modes).

As an example, let's install Security Manager in the `kube-system` namespace and configure it to select all namespaces,
except `kube-system`:

1. Clone the chart directory:
   ```
   git clone --depth 1 --branch {{ git.tag }} https://github.com/danielpacak/kube-security-manager.git
   cd kube-security-manager
   ```
   Add Aqua chart repository, which is required to install Trivy server:
   ```
   helm repo add aqua-charts https://aquasecurity.github.io/helm-charts/
   ```
2. Install the chart from a local directory:
   ```
   helm install kube-security-manager ./deploy/helm/kube-security-manager \
     --namespace kube-system
   ```
   There are many [values] in the chart that can be set to configure Security Manager.
3. Check that the `kube-security-manager` Helm release is created in the `kube-system` namespace, and it has status
   `deployed`:
   ```console
   $ helm list -n kube-system
   NAME                 	NAMESPACE  	REVISION	UPDATED                              	STATUS  	CHART                       	APP VERSION
   kube-security-manager	kube-system	1       	2022-07-05 21:50:09.711324 +0200 CEST	deployed	kube-security-manager-0.10.6	0.15.6
   ```
   To confirm that the Security Manager is running, check that the `starboard-operator` Deployment in the `kube-system`
   namespace is available and all its containers are ready:
   ```console
   $ kubectl get deployment -n kube-system
   NAME                 READY   UP-TO-DATE   AVAILABLE   AGE
   starboard-operator   1/1     1            1           11m
   ```
   If for some reason it's not ready yet, check the logs of the Deployment for errors:
   ```
   kubectl logs deployment/starboard-operator -n starboard-system
   ```

## Uninstall

You can uninstall Security Manager with the following command:

```
helm uninstall kube-security-manager -n kube-system
```

You have to manually delete custom resource definitions created by the `helm install` command:

!!! danger
    Deleting custom resource definitions will also delete all security reports generated by the operator.

    ```
    kubectl delete crd vulnerabilityreports.aquasecurity.github.io
    kubectl delete crd clustervulnerabilityreports.aquasecurity.github.io
    kubectl delete crd configauditreports.aquasecurity.github.io
    kubectl delete crd ciskubebenchreports.aquasecurity.github.io
    kubectl delete crd kubehunterreports.aquasecurity.github.io
    kubectl delete crd clusterconfigauditreports.aquasecurity.github.io
    kubectl delete crd clustercompliancereports.aquasecurity.github.io
    kubectl delete crd clustercompliancedetailreports.aquasecurity.github.io
    ```

[Helm]: https://helm.sh/
[charts]: https://helm.sh/docs/topics/charts/
[values]: https://raw.githubusercontent.com/aquasecurity/starboard/{{ git.tag }}/deploy/helm/values.yaml
